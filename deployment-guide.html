<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cruto LW業務アプリ デプロイメントガイド</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: "Hiragino Sans", "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 40px;
      font-size: 28px;
      border-bottom: 3px solid #4CAF50;
      padding-bottom: 16px;
    }
    
    h2 {
      color: #2c3e50;
      border-left: 4px solid #4CAF50;
      padding-left: 16px;
      margin-top: 40px;
      margin-bottom: 20px;
    }
    
    h3 {
      color: #34495e;
      margin-top: 24px;
      margin-bottom: 12px;
    }
    
    .step {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      position: relative;
    }
    
    .step-number {
      background: #4CAF50;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      position: absolute;
      top: 20px;
      left: 20px;
    }
    
    .step-content {
      margin-left: 50px;
    }
    
    .step-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 12px;
      font-size: 18px;
    }
    
    code {
      background: #f1f2f6;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 14px;
    }
    
    pre {
      background: #2d3748;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .warning {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    
    .warning-title {
      color: #856404;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .info {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    
    .info-title {
      color: #0c5460;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .config-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    
    .config-table th,
    .config-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    
    .config-table th {
      background: #f8f9fa;
      font-weight: 600;
    }
    
    .checklist {
      list-style: none;
      padding: 0;
    }
    
    .checklist li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }
    
    .checklist li:before {
      content: "☐ ";
      color: #4CAF50;
      font-weight: bold;
      margin-right: 8px;
    }
    
    .link-button {
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      margin: 8px 8px 8px 0;
      transition: background-color 0.2s;
    }
    
    .link-button:hover {
      background: #45a049;
    }
    
    .secondary-button {
      background: #6c757d;
    }
    
    .secondary-button:hover {
      background: #5a6268;
    }
    
    .file-structure {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 16px;
      font-family: monospace;
      font-size: 14px;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🚀 Cruto LW業務アプリ デプロイメントガイド</h1>
    
    <div class="info">
      <div class="info-title">📋 概要</div>
      <p>このガイドでは、3つのLINE WORKS業務アプリ（事故報告、入退院報告、営業支援Bot）をGitHub Pages + Google Apps Scriptで本番環境にデプロイする手順を説明します。</p>
    </div>

    <h2>🏗️ アーキテクチャ</h2>
    <div style="text-align: center; margin: 20px 0;">
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; display: inline-block;">
        <div style="margin-bottom: 16px;">
          <strong>フロントエンド</strong><br>
          GitHub Pages (静的ホスティング)
        </div>
        <div style="margin-bottom: 16px;">↕️ HTTPS通信</div>
        <div style="margin-bottom: 16px;">
          <strong>バックエンド</strong><br>
          Google Apps Script (Webアプリ)
        </div>
        <div style="margin-bottom: 16px;">↕️ API連携</div>
        <div>
          <strong>データ層</strong><br>
          Google Sheets + Google Drive
        </div>
      </div>
    </div>

    <h2>📁 ファイル構成</h2>
    <div class="file-structure">
cruto/
├── accident-report/          # 事故報告アプリ
│   ├── index.html
│   ├── result.html
│   ├── css/accident-report.css
│   └── js/accident-report.js
├── hospital-report/          # 入退院報告アプリ
│   ├── index.html
│   ├── result.html
│   ├── css/hospital-report.css
│   └── js/hospital-report.js
├── sales-bot/               # 営業支援Bot
│   ├── index.html
│   ├── css/sales-bot.css
│   └── js/sales-bot.js
├── common/                  # 共通リソース
│   ├── css/base.css
│   └── js/woff-init.js
├── gas/                     # GASスクリプト
│   ├── accident-report.gs
│   ├── hospital-report.gs
│   └── sales-bot.gs
├── index.html              # トップページ（オプション）
├── CLAUDE.md               # AI開発支援用
├── README.md               # プロジェクト説明
└── deployment-guide.html   # このガイド
    </div>

    <h2>🚀 デプロイ手順</h2>

    <div class="step">
      <div class="step-number">1</div>
      <div class="step-content">
        <div class="step-title">Google Sheetsの準備</div>
        <h3>必要なシートを作成</h3>
        <table class="config-table">
          <thead>
            <tr>
              <th>シート名</th>
              <th>用途</th>
              <th>主要列</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>事故報告</td>
              <td>事故報告データ</td>
              <td>報告日時, 発生日付, 事故種類, 写真URL等</td>
            </tr>
            <tr>
              <td>入退院管理</td>
              <td>入退院報告データ</td>
              <td>報告日時, 利用者名, 脱落理由, N列(管理用)等</td>
            </tr>
            <tr>
              <td>営業データ</td>
              <td>営業先マスタ</td>
              <td>営業先名, 契約率, 平均契約日数, 座標等</td>
            </tr>
            <tr>
              <td>事業所マスタ</td>
              <td>事業所一覧</td>
              <td>事業所ID, 事業所名, 住所</td>
            </tr>
            <tr>
              <td>利用者マスタ</td>
              <td>利用者一覧</td>
              <td>利用者ID, 名前, 事業所, 生年月日</td>
            </tr>
            <tr>
              <td>医療機関マスタ</td>
              <td>医療機関一覧</td>
              <td>機関ID, 機関名, エリア, 住所</td>
            </tr>
            <tr>
              <td>log</td>
              <td>操作ログ</td>
              <td>日時, アクション, ユーザーID等</td>
            </tr>
          </tbody>
        </table>
        
        <div class="warning">
          <div class="warning-title">⚠️ 重要</div>
          <p>Google SheetsのURLをメモしておいてください。GASで使用します。</p>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-number">2</div>
      <div class="step-content">
        <div class="step-title">Google Driveフォルダの作成</div>
        <p>事故報告の写真保存用フォルダを作成します。</p>
        <ol>
          <li>Google Driveで新しいフォルダを作成</li>
          <li>フォルダ名: <code>cruto-accident-photos</code></li>
          <li>フォルダを右クリック → 「共有」→ 「リンクを知っている全員」に設定</li>
          <li>フォルダIDをメモ（URLの最後の部分）</li>
        </ol>
        <pre>例: https://drive.google.com/drive/folders/1kNQI4KKDifydVbyVvH88ueXOJKmJChe0
フォルダID: 1kNQI4KKDifydVbyVvH88ueXOJKmJChe0</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-number">3</div>
      <div class="step-content">
        <div class="step-title">Google Apps Scriptプロジェクトの作成</div>
        <h3>新しいGASプロジェクトを作成</h3>
        <ol>
          <li><a href="https://script.google.com" target="_blank" class="link-button">script.google.com</a> にアクセス</li>
          <li>「新しいプロジェクト」をクリック</li>
          <li>プロジェクト名を「CrutoLWApps」に変更</li>
          <li>作成したGoogle Sheetsをプロジェクトにバインド</li>
        </ol>
        
        <h3>スクリプトファイルの追加</h3>
        <ol>
          <li><code>gas/accident-report.gs</code> の内容をコピー</li>
          <li>GASエディタで「ライブラリ」→「ファイル」→「新規」→「accident-report」</li>
          <li>同様に <code>hospital-report.gs</code> と <code>sales-bot.gs</code> を追加</li>
        </ol>
        
        <div class="warning">
          <div class="warning-title">🔧 設定変更が必要</div>
          <p>各GSファイル内のフォルダIDとシートIDを実際の値に変更してください。</p>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-number">4</div>
      <div class="step-content">
        <div class="step-title">GAS Webアプリのデプロイ</div>
        <ol>
          <li>GASエディタで「デプロイ」→「新しいデプロイ」</li>
          <li>種類: 「ウェブアプリ」を選択</li>
          <li>説明: 「Cruto LW Apps Backend」</li>
          <li>実行者: 「自分」</li>
          <li>アクセスできるユーザー: 「全員」</li>
          <li>「デプロイ」をクリック</li>
          <li>生成されたWebアプリURLをメモ</li>
        </ol>
        
        <pre>例: https://script.google.com/macros/s/AKfycbw2JTes...../exec</pre>
        
        <div class="info">
          <div class="info-title">💡 Tips</div>
          <p>アプリケーション、事故報告、入退院報告、営業支援でそれぞれ別のGASプロジェクトを作ることも可能です。</p>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-number">5</div>
      <div class="step-content">
        <div class="step-title">LINE WORKS WOFFアプリの作成</div>
        <h3>各アプリのWOFFを作成</h3>
        <ol>
          <li><a href="https://developers.worksmobile.com" target="_blank" class="link-button">LINE WORKS Developers</a> にアクセス</li>
          <li>「アプリ作成」→「WOFF アプリ」を選択</li>
          <li>アプリ情報を入力:
            <ul>
              <li>事故報告WOFF</li>
              <li>入退院報告WOFF</li>
              <li>営業支援Bot</li>
            </ul>
          </li>
          <li>各アプリのWOFF IDをメモ</li>
        </ol>
        
        <div class="warning">
          <div class="warning-title">📝 メモが必要</div>
          <p>3つのWOFF IDが必要です。フロントエンドのJavaScriptで使用します。</p>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-number">6</div>
      <div class="step-content">
        <div class="step-title">GitHubリポジトリの作成</div>
        <ol>
          <li><a href="https://github.com" target="_blank" class="link-button">GitHub</a> で新しいリポジトリを作成</li>
          <li>リポジトリ名: <code>cruto-lw-apps</code></li>
          <li>Public に設定</li>
          <li>プロジェクトファイルをすべてpush</li>
        </ol>
        
        <pre>git init
git add .
git commit -m "Initial commit: Cruto LW Apps"
git branch -M main
git remote add origin https://github.com/your-username/cruto-lw-apps.git
git push -u origin main</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-number">7</div>
      <div class="step-content">
        <div class="step-title">GitHub Pagesの有効化</div>
        <ol>
          <li>GitHubリポジトリの「Settings」タブ</li>
          <li>左メニューの「Pages」</li>
          <li>Source: 「Deploy from a branch」</li>
          <li>Branch: 「main」, Folder: 「/ (root)」</li>
          <li>「Save」をクリック</li>
          <li>生成されたGitHub Pages URLをメモ</li>
        </ol>
        
        <pre>例: https://your-username.github.io/cruto-lw-apps/</pre>
      </div>
    </div>

    <div class="step">
      <div class="step-number">8</div>
      <div class="step-content">
        <div class="step-title">設定ファイルの更新</div>
        <h3>各アプリのJavaScriptファイルを更新</h3>
        
        <h4>accident-report/js/accident-report.js</h4>
        <pre>config: {
  woffId: "YOUR_ACTUAL_WOFF_ID",
  gasUrl: "YOUR_ACTUAL_GAS_URL"
}</pre>

        <h4>hospital-report/js/hospital-report.js</h4>
        <pre>config: {
  woffId: "YOUR_ACTUAL_WOFF_ID", 
  gasUrl: "YOUR_ACTUAL_GAS_URL"
}</pre>

        <h4>sales-bot/js/sales-bot.js</h4>
        <pre>config: {
  woffId: "YOUR_ACTUAL_WOFF_ID",
  gasUrl: "YOUR_ACTUAL_GAS_URL"
}</pre>
        
        <div class="warning">
          <div class="warning-title">🔑 設定確認</div>
          <p>更新後、GitHubにpushして設定を反映させてください。</p>
        </div>
      </div>
    </div>

    <div class="step">
      <div class="step-number">9</div>
      <div class="step-content">
        <div class="step-title">WOFF アプリの設定</div>
        <h3>各WOFFアプリでWebアプリURLを設定</h3>
        <ol>
          <li>LINE WORKS Developers に戻る</li>
          <li>作成したWOFFアプリを選択</li>
          <li>「基本設定」→「ウェブアプリURL」</li>
          <li>GitHub PagesのURLを設定:
            <ul>
              <li>事故報告: <code>https://your-username.github.io/cruto-lw-apps/accident-report/</code></li>
              <li>入退院報告: <code>https://your-username.github.io/cruto-lw-apps/hospital-report/</code></li>
              <li>営業支援: <code>https://your-username.github.io/cruto-lw-apps/sales-bot/</code></li>
            </ul>
          </li>
          <li>「保存」をクリック</li>
        </ol>
      </div>
    </div>

    <div class="step">
      <div class="step-number">10</div>
      <div class="step-content">
        <div class="step-title">テストとデバッグ</div>
        <h3>動作確認</h3>
        <ul class="checklist">
          <li>各アプリにアクセスして初期化が成功するか</li>
          <li>WOFF SDKがユーザー情報を取得できるか</li>
          <li>フォーム送信がGASに正しく送信されるか</li>
          <li>Google Sheetsにデータが記録されるか</li>
          <li>写真アップロードが機能するか</li>
          <li>営業支援Botのルート生成が動作するか</li>
        </ul>
        
        <div class="info">
          <div class="info-title">🐛 デバッグ Tips</div>
          <p>ブラウザの開発者ツール（F12）のConsoleタブでエラーを確認できます。VConsoleが埋め込まれているため、モバイルでもデバッグ可能です。</p>
        </div>
      </div>
    </div>

    <h2>📱 アプリアクセス方法</h2>
    
    <div class="info">
      <div class="info-title">🔗 本番環境URL</div>
      <p>デプロイ完了後、以下のURLでアクセス可能です：</p>
      <ul>
        <li><strong>事故報告:</strong> <code>https://your-username.github.io/cruto-lw-apps/accident-report/</code></li>
        <li><strong>入退院報告:</strong> <code>https://your-username.github.io/cruto-lw-apps/hospital-report/</code></li>
        <li><strong>営業支援Bot:</strong> <code>https://your-username.github.io/cruto-lw-apps/sales-bot/</code></li>
      </ul>
    </div>

    <h2>🔧 メンテナンス</h2>

    <h3>コード更新手順</h3>
    <ol>
      <li>ローカルでコード修正</li>
      <li>GitHubにpush</li>
      <li>GitHub Pagesが自動デプロイ（通常5-10分）</li>
      <li>必要に応じてGASも更新</li>
    </ol>

    <h3>データ管理</h3>
    <ul>
      <li>Google Sheetsで直接データを確認・編集可能</li>
      <li>バックアップは定期的にエクスポート推奨</li>
      <li>大量データになる場合はBigQueryへの移行検討</li>
    </ul>

    <h2>🚨 トラブルシューティング</h2>

    <div class="warning">
      <div class="warning-title">よくある問題</div>
      <ul>
        <li><strong>WOFF初期化エラー:</strong> WOFF IDが正しく設定されているか確認</li>
        <li><strong>送信エラー:</strong> GAS URLが正しく、CORSエラーでないか確認</li>
        <li><strong>写真アップロード失敗:</strong> Google DriveフォルダIDと権限を確認</li>
        <li><strong>データが保存されない:</strong> Google Sheetsの列構成を確認</li>
      </ul>
    </div>

    <div class="info">
      <div class="info-title">📞 サポート</div>
      <p>技術的な問題が発生した場合は、ブラウザのConsoleログとGASの実行ログを確認してください。</p>
    </div>

    <h2>✅ デプロイ完了チェックリスト</h2>

    <ul class="checklist">
      <li>Google Sheetsにすべての必要なシートが作成されている</li>
      <li>Google DriveフォルダIDが正しく設定されている</li>
      <li>GASプロジェクトがWebアプリとしてデプロイされている</li>
      <li>3つのWOFFアプリが作成され、URLが設定されている</li>
      <li>GitHubリポジトリが作成され、GitHub Pagesが有効化されている</li>
      <li>すべてのJavaScriptファイルでwoffIdとgasUrlが更新されている</li>
      <li>各アプリが正常に動作することを確認済み</li>
      <li>テストデータでエンドツーエンドの動作確認完了</li>
    </ul>

    <div style="text-align: center; margin-top: 40px; padding: 20px; background: #e8f5e8; border-radius: 8px;">
      <h3 style="color: #2e7d32; margin-bottom: 16px;">🎉 デプロイ完了！</h3>
      <p style="color: #2e7d32; margin: 0;">Cruto LW業務アプリが本番環境で利用可能になりました。</p>
    </div>
  </div>
</body>
</html>